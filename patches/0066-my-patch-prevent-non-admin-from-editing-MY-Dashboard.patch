From 40746104ccb4e29e117af8ac4d36653976398174 Mon Sep 17 00:00:00 2001
From: Nadav Kavalerchik <nadavkav@gmail.com>
Date: Sat, 14 Oct 2017 15:14:51 +0300
Subject: [PATCH 66/95] my (patch) prevent non admin from editing MY Dashboard
 page (blocks)

---
 my/index.php | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/my/index.php b/my/index.php
index 7e3957e..f5b470c 100644
--- a/my/index.php
+++ b/my/index.php
@@ -52,7 +52,7 @@ if ($hassiteconfig && moodle_needs_upgrading()) {
 
 $strmymoodle = get_string('myhome');
 
-if (isguestuser()) {  // Force them to see system default, no editing allowed
+if (isguestuser() || !$hassiteconfig) {  // Force them to see system default, no editing allowed
     // If guests are not allowed my moodle, send them to front page.
     if (empty($CFG->allowguestmymoodle)) {
         redirect(new moodle_url('/', array('redirect' => 0)));
@@ -62,7 +62,7 @@ if (isguestuser()) {  // Force them to see system default, no editing allowed
     $USER->editing = $edit = 0;  // Just in case
     $context = context_system::instance();
     $PAGE->set_blocks_editing_capability('moodle/my:configsyspages');  // unlikely :)
-    $header = "$SITE->shortname: $strmymoodle (GUEST)";
+    $header = "$SITE->shortname: $strmymoodle";// (GUEST)";
     $pagetitle = $header;
 
 } else {        // We are trying to view or edit our own My Moodle page
-- 
1.8.3.1

