define(["jquery"],function(a){var b={sesskey:null,instances:[]},c={init:function(d,e,f,g,h,i){b.sesskey=i;var j={roleid:d,userfields:e,url:f,courseformat:g,courseid:h,progress:a("#quickfindprogress"+d),listcontainer:a("#quickfindlist"+d),xhr:null};b.instances[d]=j,a("#quickfindlistsearch"+d).on("keyup",c.search_on_type),a("#quickfindform"+d).on("submit",c.search_on_submit)},search_on_type:function(b){var d=a(b.target),e=d.val(),f=/[\-0-9]+/.exec(d.attr("id"))[0];c.search(e,f),M.util.js_pending("quickfindlist"+f)},search_on_submit:function(b){b.preventDefault();var d=a(b.target),e=/[\-0-9]+/.exec(d.attr("id"))[0],f=d.find("#quickfindlistsearch"+e).val();c.search(f,e),M.util.js_pending("quickfindlist"+e)},search:function(c,d){var e=b.instances[d],f=M.cfg.wwwroot+"/blocks/quickfindlist/quickfind.php";null!==e.xhr&&e.xhr.abort(),e.progress.css("visibility","visible"),e.xhr=a.ajax({url:f,data:{role:d,name:c,courseformat:e.courseformat,courseid:e.courseid,sesskey:b.sesskey}}).done(function(b){var c=a("<ul />");for(var f in b.people){var g=e.userfields.replace("[[firstname]]",b.people[f].firstname);g=g.replace("[[lastname]]",b.people[f].lastname),g=g.replace("[[username]]",b.people[f].username);var h=a('<li><a href="'+e.url+"&id="+b.people[f].id+'">'+g+"</a></li>");c.append(h)}a("#quickfindlist"+d).replaceWith(c),c.attr("id","quickfindlist"+d)}).fail(function(a,b){"abort"!==b&&void 0!==b&&e.listcontainer.html(b)}).always(function(){e.progress.css("visibility","hidden"),M.util.js_complete("quickfindlist"+d)})}};return c});